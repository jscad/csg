const test = require('ava')

const geom3 = require('../geometry/geom3')

const {roundedCylinder} = require('./index')

const comparePolygonsAsPoints = require('../../test/helpers/comparePolygonsAsPoints')

test('roundedCylinder (defaults)', t => {
  const obs = roundedCylinder()
  const pts = geom3.toPoints(obs)

  t.is(pts.length, 84)
})

test('roundedCylinder (options)', t => {
  // test resolution
  let obs = roundedCylinder({resolution: 5})
  let pts = geom3.toPoints(obs)
  let exp = [
  ]

  t.is(pts.length, 15)

  // test start end
  obs = roundedCylinder({resolution: 5, start: [0,0,-10], end: [0,0,10]})
  pts = geom3.toPoints(obs)
  exp = [
    [ [ 0.9510565400123596, 0.30901700258255005, -9.800000190734863 ],
      [ 0, 1, -9.800000190734863 ],
      [ 0, 1, 9.800000190734863 ],
      [ 0.9510565400123596, 0.30901700258255005, 9.800000190734863 ] ],
    [ [ 0, 1, -9.800000190734863 ],
      [ 0.9510565400123596, 0.30901700258255005, -9.800000190734863 ],
      [ 0, 6.123234262925839e-17, -10 ] ],
    [ [ 0, 6.123234262925839e-17, 10 ],
      [ 0.9510565400123596, 0.30901700258255005, 9.800000190734863 ],
      [ 0, 1, 9.800000190734863 ] ],
    [ [ 0.5877852439880371, -0.80901700258255, -9.800000190734863 ],
      [ 0.9510565400123596, 0.30901700258255005, -9.800000190734863 ],
      [ 0.9510565400123596, 0.30901700258255005, 9.800000190734863 ],
      [ 0.5877852439880371, -0.80901700258255, 9.800000190734863 ] ],
    [ [ 0.9510565400123596, 0.30901700258255005, -9.800000190734863 ],
      [ 0.5877852439880371, -0.80901700258255, -9.800000190734863 ],
      [ 5.823541433041957e-17, 1.8921834267128088e-17, -10 ] ],
    [ [ 5.823541433041957e-17, 1.8921834267128088e-17, 10 ],
      [ 0.5877852439880371, -0.80901700258255, 9.800000190734863 ],
      [ 0.9510565400123596, 0.30901700258255005, 9.800000190734863 ] ],
    [ [ -0.5877852439880371, -0.80901700258255, -9.800000190734863 ],
      [ 0.5877852439880371, -0.80901700258255, -9.800000190734863 ],
      [ 0.5877852439880371, -0.80901700258255, 9.800000190734863 ],
      [ -0.5877852439880371, -0.80901700258255, 9.800000190734863 ] ],
    [ [ 0.5877852439880371, -0.80901700258255, -9.800000190734863 ],
      [ -0.5877852439880371, -0.80901700258255, -9.800000190734863 ],
      [ 3.599146555896214e-17, -4.953800392739606e-17, -10 ] ],
    [ [ 3.599146555896214e-17, -4.953800392739606e-17, 10 ],
      [ -0.5877852439880371, -0.80901700258255, 9.800000190734863 ],
      [ 0.5877852439880371, -0.80901700258255, 9.800000190734863 ] ],
    [ [ -0.9510565400123596, 0.30901700258255005, -9.800000190734863 ],
      [ -0.5877852439880371, -0.80901700258255, -9.800000190734863 ],
      [ -0.5877852439880371, -0.80901700258255, 9.800000190734863 ],
      [ -0.9510565400123596, 0.30901700258255005, 9.800000190734863 ] ],
    [ [ -0.5877852439880371, -0.80901700258255, -9.800000190734863 ],
      [ -0.9510565400123596, 0.30901700258255005, -9.800000190734863 ],
      [ -3.599146555896214e-17, -4.953800392739606e-17, -10 ] ],
    [ [ -3.599146555896214e-17, -4.953800392739606e-17, 10 ],
      [ -0.9510565400123596, 0.30901700258255005, 9.800000190734863 ],
      [ -0.5877852439880371, -0.80901700258255, 9.800000190734863 ] ],
    [ [ -2.4492937051703357e-16, 1, -9.800000190734863 ],
      [ -0.9510565400123596, 0.30901700258255005, -9.800000190734863 ],
      [ -0.9510565400123596, 0.30901700258255005, 9.800000190734863 ],
      [ -2.4492937051703357e-16, 1, 9.800000190734863 ] ],
    [ [ -0.9510565400123596, 0.30901700258255005, -9.800000190734863 ],
      [ -2.4492937051703357e-16, 1, -9.800000190734863 ],
      [ -5.823541433041957e-17, 1.8921834267128088e-17, -10 ] ],
    [ [ -5.823541433041957e-17, 1.8921834267128088e-17, 10 ],
      [ -2.4492937051703357e-16, 1, 9.800000190734863 ],
      [ -0.9510565400123596, 0.30901700258255005, 9.800000190734863 ] ]
  ]

  t.is(pts.length, 15)
  t.true(comparePolygonsAsPoints(pts, exp))

  // test radius
  obs = roundedCylinder({resolution: 5, radius: 10})
  pts = geom3.toPoints(obs)
  exp = [
    [ [ 9.510564804077148, -0.800000011920929, -3.090169906616211 ],
      [ 0, -0.800000011920929, -10 ],
      [ 0, 0.800000011920929, -10 ],
      [ 9.510564804077148, 0.800000011920929, -3.090169906616211 ] ],
    [ [ 0, -0.800000011920929, -10 ],
      [ 9.510564804077148, -0.800000011920929, -3.090169906616211 ],
      [ 0, -1, -6.123233998228043e-16 ] ],
    [ [ 0, 1, -6.123233998228043e-16 ],
      [ 9.510564804077148, 0.800000011920929, -3.090169906616211 ],
      [ 0, 0.800000011920929, -10 ] ],
    [ [ 5.877852439880371, -0.800000011920929, 8.090169906616211 ],
      [ 9.510564804077148, -0.800000011920929, -3.090169906616211 ],
      [ 9.510564804077148, 0.800000011920929, -3.090169906616211 ],
      [ 5.877852439880371, 0.800000011920929, 8.090169906616211 ] ],
    [ [ 9.510564804077148, -0.800000011920929, -3.090169906616211 ],
      [ 5.877852439880371, -0.800000011920929, 8.090169906616211 ],
      [ 5.823541565390855e-16, -1, -1.8921833274511353e-16 ] ],
    [ [ 5.823541565390855e-16, 1, -1.8921833274511353e-16 ],
      [ 5.877852439880371, 0.800000011920929, 8.090169906616211 ],
      [ 9.510564804077148, 0.800000011920929, -3.090169906616211 ] ],
    [ [ -5.877852439880371, -0.800000011920929, 8.090169906616211 ],
      [ 5.877852439880371, -0.800000011920929, 8.090169906616211 ],
      [ 5.877852439880371, 0.800000011920929, 8.090169906616211 ],
      [ -5.877852439880371, 0.800000011920929, 8.090169906616211 ] ],
    [ [ 5.877852439880371, -0.800000011920929, 8.090169906616211 ],
      [ -5.877852439880371, -0.800000011920929, 8.090169906616211 ],
      [ 3.599146489721765e-16, -1, 4.953800194216259e-16 ] ],
    [ [ 3.599146489721765e-16, 1, 4.953800194216259e-16 ],
      [ -5.877852439880371, 0.800000011920929, 8.090169906616211 ],
      [ 5.877852439880371, 0.800000011920929, 8.090169906616211 ] ],
    [ [ -9.510564804077148, -0.800000011920929, -3.090169906616211 ],
      [ -5.877852439880371, -0.800000011920929, 8.090169906616211 ],
      [ -5.877852439880371, 0.800000011920929, 8.090169906616211 ],
      [ -9.510564804077148, 0.800000011920929, -3.090169906616211 ] ],
    [ [ -5.877852439880371, -0.800000011920929, 8.090169906616211 ],
      [ -9.510564804077148, -0.800000011920929, -3.090169906616211 ],
      [ -3.599146489721765e-16, -1, 4.953800194216259e-16 ] ],
    [ [ -3.599146489721765e-16, 1, 4.953800194216259e-16 ],
      [ -9.510564804077148, 0.800000011920929, -3.090169906616211 ],
      [ -5.877852439880371, 0.800000011920929, 8.090169906616211 ] ],
    [ [ -2.4492935992912173e-15, -0.800000011920929, -10 ],
      [ -9.510564804077148, -0.800000011920929, -3.090169906616211 ],
      [ -9.510564804077148, 0.800000011920929, -3.090169906616211 ],
      [ -2.4492935992912173e-15, 0.800000011920929, -10 ] ],
    [ [ -9.510564804077148, -0.800000011920929, -3.090169906616211 ],
      [ -2.4492935992912173e-15, -0.800000011920929, -10 ],
      [ -5.823541565390855e-16, -1, -1.8921833274511353e-16 ] ],
    [ [ -5.823541565390855e-16, 1, -1.8921833274511353e-16 ],
      [ -2.4492935992912173e-15, 0.800000011920929, -10 ],
      [ -9.510564804077148, 0.800000011920929, -3.090169906616211 ] ]
  ]

  t.is(pts.length, 15)
  t.true(comparePolygonsAsPoints(pts, exp))

  // test round radius
  obs = roundedCylinder({resolution: 5, start: [0,0,-10], end: [0,0,10], radius: 5, roundRadius: 2})
  pts = geom3.toPoints(obs)
  exp = [
    [ [ 4.755282402038574, 1.5450849533081055, -8 ],
      [ 0, 5, -8 ],
      [ 0, 5, 8 ],
      [ 4.755282402038574, 1.5450849533081055, 8 ] ],
    [ [ 0, 5, -8 ],
      [ 4.755282402038574, 1.5450849533081055, -8 ],
      [ 0, 3.0616169991140216e-16, -10 ] ],
    [ [ 0, 3.0616169991140216e-16, 10 ],
      [ 4.755282402038574, 1.5450849533081055, 8 ],
      [ 0, 5, 8 ] ],
    [ [ 2.9389262199401855, -4.0450849533081055, -8 ],
      [ 4.755282402038574, 1.5450849533081055, -8 ],
      [ 4.755282402038574, 1.5450849533081055, 8 ],
      [ 2.9389262199401855, -4.0450849533081055, 8 ] ],
    [ [ 4.755282402038574, 1.5450849533081055, -8 ],
      [ 2.9389262199401855, -4.0450849533081055, -8 ],
      [ 2.9117707826954275e-16, 9.460916637255676e-17, -10 ] ],
    [ [ 2.9117707826954275e-16, 9.460916637255676e-17, 10 ],
      [ 2.9389262199401855, -4.0450849533081055, 8 ],
      [ 4.755282402038574, 1.5450849533081055, 8 ] ],
    [ [ -2.9389262199401855, -4.0450849533081055, -8 ],
      [ 2.9389262199401855, -4.0450849533081055, -8 ],
      [ 2.9389262199401855, -4.0450849533081055, 8 ],
      [ -2.9389262199401855, -4.0450849533081055, 8 ] ],
    [ [ 2.9389262199401855, -4.0450849533081055, -8 ],
      [ -2.9389262199401855, -4.0450849533081055, -8 ],
      [ 1.7995732448608824e-16, -2.4769000971081295e-16, -10 ] ],
    [ [ 1.7995732448608824e-16, -2.4769000971081295e-16, 10 ],
      [ -2.9389262199401855, -4.0450849533081055, 8 ],
      [ 2.9389262199401855, -4.0450849533081055, 8 ] ],
    [ [ -4.755282402038574, 1.5450849533081055, -8 ],
      [ -2.9389262199401855, -4.0450849533081055, -8 ],
      [ -2.9389262199401855, -4.0450849533081055, 8 ],
      [ -4.755282402038574, 1.5450849533081055, 8 ] ],
    [ [ -2.9389262199401855, -4.0450849533081055, -8 ],
      [ -4.755282402038574, 1.5450849533081055, -8 ],
      [ -1.7995732448608824e-16, -2.4769000971081295e-16, -10 ] ],
    [ [ -1.7995732448608824e-16, -2.4769000971081295e-16, 10 ],
      [ -4.755282402038574, 1.5450849533081055, 8 ],
      [ -2.9389262199401855, -4.0450849533081055, 8 ] ],
    [ [ -1.2246467996456087e-15, 5, -8 ],
      [ -4.755282402038574, 1.5450849533081055, -8 ],
      [ -4.755282402038574, 1.5450849533081055, 8 ],
      [ -1.2246467996456087e-15, 5, 8 ] ],
    [ [ -4.755282402038574, 1.5450849533081055, -8 ],
      [ -1.2246467996456087e-15, 5, -8 ],
      [ -2.9117707826954275e-16, 9.460916637255676e-17, -10 ] ],
    [ [ -2.9117707826954275e-16, 9.460916637255676e-17, 10 ],
      [ -1.2246467996456087e-15, 5, 8 ],
      [ -4.755282402038574, 1.5450849533081055, 8 ] ]
  ]

  t.is(pts.length, 15)
  t.true(comparePolygonsAsPoints(pts, exp))
})
